var PopoverModel = (function () {
    function PopoverModel() {
        var _this = this;
        this.downloadStationConfigured = ko.observable(false);
        this.loggedIn = ko.observable(false);
        this.statusMessage = ko.observable();
        this.deviceName = ko.observable();
        this.dsmVersion = ko.observable();
        this.dsmVersionString = ko.observable();
        this.fullUrl = ko.observable();
        this.tasks = ko.observableArray();
        this.urlInput = ko.observable();
        this.urlInputValue = ko.computed(function () {
            var value = $.trim(_this.urlInput());
            return value.length == 0 ? null : value;
        });
        this.statusMessageLocalized = ko.computed(function () {
            if (typeof _this.statusMessage() !== "string")
                return null;
            else if (_this.statusMessage() == "dsmVersionTooOld") {
                return 'Your device seems to be running DSM ' + _this.dsmVersionString() + '-' + _this.dsmVersion() + '. This version is not supported anymore in this version of the extension. You can download an old version of this extension that supports DSM 4.1 and older from <a href="http://www.download-station-extension.com/" target="_blank">this website</a>.';
            }
            else {
                var localizedMessage = extension.getLocalizedString(_this.statusMessage());
                if (localizedMessage != _this.statusMessage())
                    return localizedMessage;
                return extension.getLocalizedString("api_error_" + _this.statusMessage());
            }
        });
        this.visibleTasks = ko.computed(function () {
            return ko.utils.arrayFilter(_this.tasks(), function (task) {
                return task.visible();
            });
        });
        this.pausebleTasks = ko.computed(function () {
            return ko.utils.arrayFilter(_this.visibleTasks(), function (task) {
                return task.pauseButtonVisible();
            });
        });
        this.resumebleTasks = ko.computed(function () {
            return ko.utils.arrayFilter(_this.visibleTasks(), function (task) {
                return task.resumeButtonVisible();
            });
        });
        this.finishedTasks = ko.computed(function () {
            return ko.utils.arrayFilter(_this.tasks(), function (task) {
                return task.status() == "finished";
            });
        });
        this.totalDownloadSpeed = ko.computed(function () {
            var tasks = _this.tasks();
            var speed = 0;
            for (var i = 0; i < tasks.length; i++) {
                if (tasks[i].status() != "paused")
                    speed += tasks[i].speedDownload();
            }
            return speed;
        });
        this.totalDownloadSpeedString = ko.computed(function () {
            return bytesToString(_this.totalDownloadSpeed()) + "/s";
        });
        this.totalUploadSpeed = ko.computed(function () {
            var tasks = _this.tasks();
            var speed = 0;
            for (var i = 0; i < tasks.length; i++) {
                if (tasks[i].status() != "paused")
                    speed += tasks[i].speedUpload();
            }
            return speed;
        });
        this.totalUploadSpeedString = ko.computed(function () {
            return bytesToString(_this.totalUploadSpeed()) + "/s";
        });
        this.formDisabled = ko.observable(false);
        this.newTaskErrorMessage = ko.observable();
        this.hideSeedingTorrents = ko.observable(false);
        this.clearingFinishedTasks = ko.observable(false);
    }
    PopoverModel.prototype.maxNumberOfTasksWarning = function () {
        return extension.getLocalizedString("maxNumberOfTasksWarning", ["100"]);
    };
    PopoverModel.prototype.clearFinishedTasks = function (item, event) {
        var _this = this;
        if ($(event.target).hasClass("disabled"))
            return;
        this.clearingFinishedTasks(true);
        var tasks = this.finishedTasks();
        for (var i = 0; i < tasks.length; i++) {
            tasks[i].removed(true);
        }
        getBackgroundPage().clearFinishedTasks(function (success, data) {
            _this.clearingFinishedTasks(false);
            if (success == false) {
                for (var i = 0; i < tasks.length; i++) {
                    tasks[i].removed(false);
                }
            }
        });
    };
    PopoverModel.prototype.addTask = function () {
        var _this = this;
        if (this.urlInputValue()) {
            this.formDisabled(true);
            this.newTaskErrorMessage(null);
            $(".url-input").blur();
            getBackgroundPage().createTask(this.urlInputValue(), null, null, null, function (success, data) {
                _this.formDisabled(false);
                if (success === true) {
                    _this.urlInput(null);
                    _this.toggleTaskForm(false);
                }
                else {
                    _this.newTaskErrorMessage(extension.getLocalizedString("api_error_" + data));
                    $(".url-input").focus();
                }
            });
            _gaq.push(['_trackEvent', 'Button', 'Popover AddTaskSubmit']);
        }
    };
    ;
    PopoverModel.prototype.hideTaskElement = function (elem) {
        if (elem.nodeType === 1) {
            $(elem).addClass('hidden');
            setTimeout(function () { $(elem).remove(); }, 500);
        }
    };
    ;
    PopoverModel.prototype.showTaskElement = function (elem, index, value) {
        if (elem.nodeType === 1) {
            $(elem).hide().fadeIn(100);
        }
    };
    ;
    PopoverModel.prototype.resumeAll = function (item, event) {
        if ($(event.target).hasClass("disabled"))
            return;
        var tasks = ko.utils.arrayFilter(this.visibleTasks(), function (task) {
            return task.status() != "finished";
        });
        var ids = new Array();
        $(event.target).addClass("disabled");
        for (var i = 0; i < tasks.length; i++) {
            var task = tasks[i];
            if (!task.resuming()) {
                task.resuming(true);
                ids.push(task.id());
            }
        }
        getBackgroundPage().resumeTask(ids, function (success) {
            $(event.target).removeClass("disabled");
            for (var i = 0; i < tasks.length; i++) {
                var task = tasks[i];
                task.resuming(false);
                if (success) {
                    task.status("waiting");
                }
            }
        });
    };
    ;
    PopoverModel.prototype.pauseAll = function (item, event) {
        if ($(event.target).hasClass("disabled"))
            return;
        var tasks = this.pausebleTasks();
        var ids = new Array();
        $(event.target).addClass("disabled");
        for (var i = 0; i < tasks.length; i++) {
            var task = tasks[i];
            if (!task.pausing()) {
                task.pausing(true);
                ids.push(task.id());
            }
        }
        getBackgroundPage().pauseTask(ids, function (success) {
            $(event.target).removeClass("disabled");
            for (var i = 0; i < tasks.length; i++) {
                var task = tasks[i];
                task.pausing(false);
                if (success) {
                    task.status("paused");
                }
            }
        });
    };
    ;
    PopoverModel.prototype.openSettings = function () {
        extension.createTab("options.html");
        extension.hidePopovers();
        _gaq.push(['_trackEvent', 'Button', 'Popover OpenOptionsTab']);
    };
    ;
    PopoverModel.prototype.toggleTaskForm = function (visible) {
        if (typeof visible === "boolean")
            $(".new-task").toggleClass("active", visible);
        else
            $(".new-task").toggleClass("active");
        if ($(".new-task").hasClass("active"))
            $(".url-input").focus();
        else
            $(".url-input").blur();
    };
    ;
    PopoverModel.prototype.openDownloadStation = function () {
        if (this.fullUrl() != null) {
            var url = this.fullUrl();
            if (this.dsmVersion() < 7000)
                url += "/webman/index.cgi?launchApp=SYNO.SDS.DownloadStation.Application";
            else
                url += "/index.cgi?launchApp=SYNO.SDS.DownloadStation.Application";
            extension.createTab(url);
            extension.hidePopovers();
            _gaq.push(['_trackEvent', 'Button', 'Popover OpenDownloadStationTab']);
        }
    };
    ;
    PopoverModel.prototype.localizedString = function (name, substitutions) {
        return extension.getLocalizedString(name, substitutions);
    };
    ;
    return PopoverModel;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3BvcG92ZXItcG9wb3Zlcm1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0lBQUE7UUFBQSxpQkFzUEM7UUFwUEEsOEJBQXlCLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqRCxhQUFRLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxrQkFBYSxHQUFHLEVBQUUsQ0FBQyxVQUFVLEVBQVUsQ0FBQztRQUN4QyxlQUFVLEdBQUcsRUFBRSxDQUFDLFVBQVUsRUFBVSxDQUFDO1FBQ3JDLGVBQVUsR0FBRyxFQUFFLENBQUMsVUFBVSxFQUFVLENBQUM7UUFDckMscUJBQWdCLEdBQUcsRUFBRSxDQUFDLFVBQVUsRUFBVSxDQUFDO1FBQzNDLFlBQU8sR0FBRyxFQUFFLENBQUMsVUFBVSxFQUFVLENBQUM7UUFDbEMsVUFBSyxHQUFHLEVBQUUsQ0FBQyxlQUFlLEVBQWEsQ0FBQztRQUV4QyxhQUFRLEdBQUcsRUFBRSxDQUFDLFVBQVUsRUFBVSxDQUFDO1FBRW5DLGtCQUFhLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBUztZQUNuQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBTUgsMkJBQXNCLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBUztZQUM1QyxFQUFFLENBQUEsQ0FBQyxPQUFPLEtBQUksQ0FBQyxhQUFhLEVBQUUsS0FBSyxRQUFRLENBQUM7Z0JBQzNDLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDUCxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLGtCQUFrQixDQUFDLENBQUMsQ0FBQztnQkFDakQsTUFB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USxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN6QixJQUFJO1lBQ0gsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3pCLENBQUM7O0lBRUQsMENBQW1CLEdBQW5CO1FBQ0MsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDM0IsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3pCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxJQUFJLENBQUM7Z0JBQzNCLEdBQUcsSUFBSSxrRUFBa0UsQ0FBQztZQUMzRSxJQUFJO2dCQUNILEdBQUcsSUFBSSwyREFBMkQsQ0FBQztZQUVwRSxTQUFTLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxFQUFHLFFBQVEsRUFBRyxnQ0FBZ0MsQ0FBRSxDQUFFLENBQUM7UUFDNUUsQ0FBQztJQUNGLENBQUM7O0lBRUQsc0NBQWUsR0FBZixVQUFnQixJQUFZLEVBQUUsYUFBdUI7UUFDcEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFDMUQsQ0FBQzs7SUFDRixtQkFBQztBQUFELENBdFBBLEFBc1BDLElBQUEiLCJmaWxlIjoianMvcG9wb3Zlci1wb3BvdmVybW9kZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBQb3BvdmVyTW9kZWwge1xuXG5cdGRvd25sb2FkU3RhdGlvbkNvbmZpZ3VyZWQgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcblx0bG9nZ2VkSW4gPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcblx0c3RhdHVzTWVzc2FnZSA9IGtvLm9ic2VydmFibGU8c3RyaW5nPigpO1xuXHRkZXZpY2VOYW1lID0ga28ub2JzZXJ2YWJsZTxzdHJpbmc+KCk7XG5cdGRzbVZlcnNpb24gPSBrby5vYnNlcnZhYmxlPG51bWJlcj4oKTtcblx0ZHNtVmVyc2lvblN0cmluZyA9IGtvLm9ic2VydmFibGU8c3RyaW5nPigpO1xuXHRmdWxsVXJsID0ga28ub2JzZXJ2YWJsZTxzdHJpbmc+KCk7XG5cdHRhc2tzID0ga28ub2JzZXJ2YWJsZUFycmF5PFRhc2tNb2RlbD4oKTtcblx0XG5cdHVybElucHV0ID0ga28ub2JzZXJ2YWJsZTxzdHJpbmc+KCk7XG5cdFxuXHR1cmxJbnB1dFZhbHVlID0ga28uY29tcHV0ZWQ8c3RyaW5nPigoKSA9PiB7XG5cdFx0dmFyIHZhbHVlID0gJC50cmltKHRoaXMudXJsSW5wdXQoKSk7XG5cdFx0cmV0dXJuIHZhbHVlLmxlbmd0aCA9PSAwID8gbnVsbCA6IHZhbHVlO1xuXHR9KTtcblx0XG5cdG1heE51bWJlck9mVGFza3NXYXJuaW5nKCkge1xuXHRcdHJldHVybiBleHRlbnNpb24uZ2V0TG9jYWxpemVkU3RyaW5nKFwibWF4TnVtYmVyT2ZUYXNrc1dhcm5pbmdcIiwgW1wiMTAwXCJdKTtcblx0fVxuXHRcblx0c3RhdHVzTWVzc2FnZUxvY2FsaXplZCA9IGtvLmNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuXHRcdGlmKHR5cGVvZiB0aGlzLnN0YXR1c01lc3NhZ2UoKSAhPT0gXCJzdHJpbmdcIilcblx0XHRcdHJldHVybiBudWxsO1xuICAgICAgICBlbHNlIGlmKHRoaXMuc3RhdHVzTWVzc2FnZSgpID09IFwiZHNtVmVyc2lvblRvb09sZFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1lvdXIgZGV2aWNlIHNlZW1zIHRvIGJlIHJ1bm5pbmcgRFNNICcgKyB0aGlzLmRzbVZlcnNpb25TdHJpbmcoKSArICctJyArIHRoaXMuZHNtVmVyc2lvbigpICsgJy4gVGhpcyB2ZXJzaW9uIGlzIG5vdCBzdXBwb3J0ZWQgYW55bW9yZSBpbiB0aGlzIHZlcnNpb24gb2YgdGhlIGV4dGVuc2lvbi4gWW91IGNhbiBkb3dubG9hZCBhbiBvbGQgdmVyc2lvbiBvZiB0aGlzIGV4dGVuc2lvbiB0aGF0IHN1cHBvcnRzIERTTSA0LjEgYW5kIG9sZGVyIGZyb20gPGEgaHJlZj1cImh0dHA6Ly93d3cuZG93bmxvYWQtc3RhdGlvbi1leHRlbnNpb24uY29tL1wiIHRhcmdldD1cIl9ibGFua1wiPnRoaXMgd2Vic2l0ZTwvYT4uJztcbiAgICAgICAgfVxuXHRcdGVsc2Uge1xuXHRcdFx0dmFyIGxvY2FsaXplZE1lc3NhZ2UgPSBleHRlbnNpb24uZ2V0TG9jYWxpemVkU3RyaW5nKHRoaXMuc3RhdHVzTWVzc2FnZSgpKTtcblx0XHRcdGlmKGxvY2FsaXplZE1lc3NhZ2UgIT0gdGhpcy5zdGF0dXNNZXNzYWdlKCkpXG5cdFx0XHRcdHJldHVybiBsb2NhbGl6ZWRNZXNzYWdlO1xuXHRcdFx0IHJldHVybiBleHRlbnNpb24uZ2V0TG9jYWxpemVkU3RyaW5nKFwiYXBpX2Vycm9yX1wiICsgdGhpcy5zdGF0dXNNZXNzYWdlKCkpO1xuXHRcdH1cblx0fSk7XG5cdFxuXHR2aXNpYmxlVGFza3MgPSBrby5jb21wdXRlZDxUYXNrTW9kZWxbXT4oKCkgPT4ge1xuXHRcdHJldHVybiBrby51dGlscy5hcnJheUZpbHRlcih0aGlzLnRhc2tzKCksICh0YXNrKSA9PiB7XG5cdFx0XHRyZXR1cm4gdGFzay52aXNpYmxlKCk7XG5cdFx0fSk7XG5cdH0pO1xuXHRcblx0cGF1c2VibGVUYXNrcyA9IGtvLmNvbXB1dGVkPFRhc2tNb2RlbFtdPigoKSA9PiB7XG5cdFx0cmV0dXJuIGtvLnV0aWxzLmFycmF5RmlsdGVyKHRoaXMudmlzaWJsZVRhc2tzKCksICh0YXNrKSA9PiB7XG5cdFx0XHRyZXR1cm4gdGFzay5wYXVzZUJ1dHRvblZpc2libGUoKTtcblx0XHR9KTtcblx0fSk7XG5cdFxuXHRyZXN1bWVibGVUYXNrcyA9IGtvLmNvbXB1dGVkPFRhc2tNb2RlbFtdPigoKSA9PiB7XG5cdFx0cmV0dXJuIGtvLnV0aWxzLmFycmF5RmlsdGVyKHRoaXMudmlzaWJsZVRhc2tzKCksICh0YXNrKSA9PiB7XG5cdFx0XHRyZXR1cm4gdGFzay5yZXN1bWVCdXR0b25WaXNpYmxlKCk7XG5cdFx0fSk7XG5cdH0pOyBcblx0XG5cdGZpbmlzaGVkVGFza3MgPSBrby5jb21wdXRlZDxUYXNrTW9kZWxbXT4oKCkgPT4ge1xuXHRcdHJldHVybiBrby51dGlscy5hcnJheUZpbHRlcih0aGlzLnRhc2tzKCksICh0YXNrKSA9PiB7XG5cdFx0XHRyZXR1cm4gdGFzay5zdGF0dXMoKSA9PSBcImZpbmlzaGVkXCI7XG5cdFx0fSk7XG5cdH0pO1xuXHRcblx0dG90YWxEb3dubG9hZFNwZWVkID0ga28uY29tcHV0ZWQ8bnVtYmVyPigoKSA9PiB7XG5cdFx0dmFyIHRhc2tzID0gdGhpcy50YXNrcygpO1xuXHRcdHZhciBzcGVlZCA9IDA7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSsrKVxuXHRcdHtcblx0XHRcdGlmKHRhc2tzW2ldLnN0YXR1cygpICE9IFwicGF1c2VkXCIpXG5cdFx0XHRcdHNwZWVkICs9IHRhc2tzW2ldLnNwZWVkRG93bmxvYWQoKTtcblx0XHR9XG5cdFx0cmV0dXJuIHNwZWVkO1xuXHR9KTtcblx0XG5cdHRvdGFsRG93bmxvYWRTcGVlZFN0cmluZyA9IGtvLmNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuXHRcdHJldHVybiBieXRlc1RvU3RyaW5nKHRoaXMudG90YWxEb3dubG9hZFNwZWVkKCkpICsgXCIvc1wiO1xuXHR9KVxuXHRcblx0dG90YWxVcGxvYWRTcGVlZCA9IGtvLmNvbXB1dGVkPG51bWJlcj4oKCkgPT4ge1xuXHRcdHZhciB0YXNrcyA9IHRoaXMudGFza3MoKTtcblx0XHR2YXIgc3BlZWQgPSAwO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCB0YXNrcy5sZW5ndGg7IGkrKylcblx0XHR7XG5cdFx0XHRpZih0YXNrc1tpXS5zdGF0dXMoKSAhPSBcInBhdXNlZFwiKVxuXHRcdFx0XHRzcGVlZCArPSB0YXNrc1tpXS5zcGVlZFVwbG9hZCgpO1xuXHRcdH1cblx0XHRyZXR1cm4gc3BlZWQ7XG5cdH0pO1xuXHRcblx0dG90YWxVcGxvYWRTcGVlZFN0cmluZyA9IGtvLmNvbXB1dGVkPHN0cmluZz4oKCkgPT4ge1xuXHRcdHJldHVybiBieXRlc1RvU3RyaW5nKHRoaXMudG90YWxVcGxvYWRTcGVlZCgpKSArIFwiL3NcIjtcblx0fSlcblx0XG5cdGZvcm1EaXNhYmxlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuXHRuZXdUYXNrRXJyb3JNZXNzYWdlID0ga28ub2JzZXJ2YWJsZSgpO1xuXHRoaWRlU2VlZGluZ1RvcnJlbnRzID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG5cdGNsZWFyaW5nRmluaXNoZWRUYXNrcyA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuXHRcblx0Y2xlYXJGaW5pc2hlZFRhc2tzKGl0ZW06IFRhc2tNb2RlbCwgZXZlbnQ6IEV2ZW50KTogdm9pZCB7XG5cdFx0aWYoJChldmVudC50YXJnZXQpLmhhc0NsYXNzKFwiZGlzYWJsZWRcIikpXG5cdFx0XHRyZXR1cm47XG5cdFx0XG5cdFx0dGhpcy5jbGVhcmluZ0ZpbmlzaGVkVGFza3ModHJ1ZSk7XG5cdFx0XG5cdFx0dmFyIHRhc2tzID0gdGhpcy5maW5pc2hlZFRhc2tzKCk7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR0YXNrc1tpXS5yZW1vdmVkKHRydWUpO1xuXHRcdH1cblx0XHRcblx0XHRnZXRCYWNrZ3JvdW5kUGFnZSgpLmNsZWFyRmluaXNoZWRUYXNrcygoc3VjY2VzcywgZGF0YSkgPT4ge1xuXHRcdFx0dGhpcy5jbGVhcmluZ0ZpbmlzaGVkVGFza3MoZmFsc2UpO1xuXHRcdFx0XG5cdFx0XHRpZihzdWNjZXNzID09IGZhbHNlKSB7XG5cdFx0XHRcdGZvcih2YXIgaSA9IDA7IGkgPCB0YXNrcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHRhc2tzW2ldLnJlbW92ZWQoZmFsc2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XG5cdGFkZFRhc2soKTogdm9pZCB7XG5cdFx0aWYodGhpcy51cmxJbnB1dFZhbHVlKCkpe1xuXHRcdFx0dGhpcy5mb3JtRGlzYWJsZWQodHJ1ZSk7XG5cdFx0XHR0aGlzLm5ld1Rhc2tFcnJvck1lc3NhZ2UobnVsbCk7XG5cdFx0XHQkKFwiLnVybC1pbnB1dFwiKS5ibHVyKCk7XG5cdFx0XHRnZXRCYWNrZ3JvdW5kUGFnZSgpLmNyZWF0ZVRhc2sodGhpcy51cmxJbnB1dFZhbHVlKCksIG51bGwsIG51bGwsIG51bGwsIChzdWNjZXNzLCBkYXRhKSA9PiB7XG5cdFx0XHRcdHRoaXMuZm9ybURpc2FibGVkKGZhbHNlKTtcblx0XHRcdFx0aWYoc3VjY2VzcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdHRoaXMudXJsSW5wdXQobnVsbCk7XG5cdFx0XHRcdFx0dGhpcy50b2dnbGVUYXNrRm9ybShmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5uZXdUYXNrRXJyb3JNZXNzYWdlKGV4dGVuc2lvbi5nZXRMb2NhbGl6ZWRTdHJpbmcoXCJhcGlfZXJyb3JfXCIgKyBkYXRhKSk7XG5cdFx0XHRcdFx0JChcIi51cmwtaW5wdXRcIikuZm9jdXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRfZ2FxLnB1c2goWydfdHJhY2tFdmVudCcgLCAnQnV0dG9uJyAsICdQb3BvdmVyIEFkZFRhc2tTdWJtaXQnIF0gKTtcblx0XHR9XG5cdH07XG5cdFxuXHRoaWRlVGFza0VsZW1lbnQoZWxlbTogRWxlbWVudCk6IHZvaWQge1xuXHRcdGlmIChlbGVtLm5vZGVUeXBlID09PSAxKSB7XG5cdFx0XHQkKGVsZW0pLmFkZENsYXNzKCdoaWRkZW4nKTtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4geyAkKGVsZW0pLnJlbW92ZSgpfSw1MDApO1xuXHRcdH1cblx0fTtcblxuXHRzaG93VGFza0VsZW1lbnQoZWxlbTogRWxlbWVudCwgaW5kZXg6IG51bWJlciwgdmFsdWU6IFRhc2tNb2RlbCk6IHZvaWQge1xuXHRcdGlmKGVsZW0ubm9kZVR5cGUgPT09IDEpIHtcblx0XHRcdCQoZWxlbSkuaGlkZSgpLmZhZGVJbigxMDApO1xuXHRcdH1cblx0fTtcblx0XG5cdHJlc3VtZUFsbChpdGVtOiBhbnksIGV2ZW50OiBFdmVudCk6IHZvaWQge1xuXHRcdGlmKCQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcyhcImRpc2FibGVkXCIpKVxuXHRcdFx0cmV0dXJuO1xuXHRcdFxuXHRcdHZhciB0YXNrcyA9IGtvLnV0aWxzLmFycmF5RmlsdGVyKHRoaXMudmlzaWJsZVRhc2tzKCksICh0YXNrKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGFzay5zdGF0dXMoKSAhPSBcImZpbmlzaGVkXCI7XG4gICAgICAgIH0pO1xuXG5cdFx0dmFyIGlkcyA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XG5cdFx0XG5cdFx0JChldmVudC50YXJnZXQpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG5cdFx0XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgdGFzayA9IHRhc2tzW2ldO1xuXHRcdFx0aWYoIXRhc2sucmVzdW1pbmcoKSkge1xuXHRcdFx0XHR0YXNrLnJlc3VtaW5nKHRydWUpO1xuXHRcdFx0XHRpZHMucHVzaCh0YXNrLmlkKCkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRnZXRCYWNrZ3JvdW5kUGFnZSgpLnJlc3VtZVRhc2soaWRzLCAoc3VjY2VzczogYm9vbGVhbikgPT4ge1xuXHRcdFx0JChldmVudC50YXJnZXQpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG5cdFx0XHRmb3IodmFyIGkgPSAwOyBpIDwgdGFza3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dmFyIHRhc2sgPSB0YXNrc1tpXTtcblx0XHRcdFx0dGFzay5yZXN1bWluZyhmYWxzZSk7XG5cdFx0XHRcdGlmKHN1Y2Nlc3MpIHtcblx0XHRcdFx0XHR0YXNrLnN0YXR1cyhcIndhaXRpbmdcIik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblx0XG5cdHBhdXNlQWxsKGl0ZW06IGFueSwgZXZlbnQ6IEV2ZW50KTogdm9pZCB7XG5cdFx0aWYoJChldmVudC50YXJnZXQpLmhhc0NsYXNzKFwiZGlzYWJsZWRcIikpXG5cdFx0XHRyZXR1cm47XG5cdFx0XG5cdFx0dmFyIHRhc2tzID0gdGhpcy5wYXVzZWJsZVRhc2tzKCk7XG5cdFx0dmFyIGlkcyA9IG5ldyBBcnJheSgpO1xuXHRcdFxuXHRcdCQoZXZlbnQudGFyZ2V0KS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuXHRcdFxuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCB0YXNrcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIHRhc2sgPSB0YXNrc1tpXTtcblx0XHRcdGlmKCF0YXNrLnBhdXNpbmcoKSkge1xuXHRcdFx0XHR0YXNrLnBhdXNpbmcodHJ1ZSk7XG5cdFx0XHRcdGlkcy5wdXNoKHRhc2suaWQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGdldEJhY2tncm91bmRQYWdlKCkucGF1c2VUYXNrKGlkcywgKHN1Y2Nlc3M6IGJvb2xlYW4pID0+IHtcblx0XHRcdCQoZXZlbnQudGFyZ2V0KS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuXHRcdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHZhciB0YXNrID0gdGFza3NbaV07XG5cdFx0XHRcdHRhc2sucGF1c2luZyhmYWxzZSk7XG5cdFx0XHRcdGlmKHN1Y2Nlc3MpIHtcblx0XHRcdFx0XHR0YXNrLnN0YXR1cyhcInBhdXNlZFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXHRcblx0b3BlblNldHRpbmdzKCk6IHZvaWQge1xuXHRcdGV4dGVuc2lvbi5jcmVhdGVUYWIoXCJvcHRpb25zLmh0bWxcIik7XG5cdFx0ZXh0ZW5zaW9uLmhpZGVQb3BvdmVycygpO1xuXHRcdF9nYXEucHVzaChbJ190cmFja0V2ZW50JyAsICdCdXR0b24nICwgJ1BvcG92ZXIgT3Blbk9wdGlvbnNUYWInIF0gKTtcblx0fTtcblx0XG5cdHRvZ2dsZVRhc2tGb3JtKHZpc2libGU6IGJvb2xlYW4pOiB2b2lkIHtcblx0XHRpZih0eXBlb2YgdmlzaWJsZSA9PT0gXCJib29sZWFuXCIpXG5cdFx0XHQkKFwiLm5ldy10YXNrXCIpLnRvZ2dsZUNsYXNzKFwiYWN0aXZlXCIsIHZpc2libGUpO1xuXHRcdGVsc2Vcblx0XHRcdCQoXCIubmV3LXRhc2tcIikudG9nZ2xlQ2xhc3MoXCJhY3RpdmVcIik7XG5cdFx0XG5cdFx0aWYoJChcIi5uZXctdGFza1wiKS5oYXNDbGFzcyhcImFjdGl2ZVwiKSlcblx0XHRcdCQoXCIudXJsLWlucHV0XCIpLmZvY3VzKCk7XG5cdFx0ZWxzZVxuXHRcdFx0JChcIi51cmwtaW5wdXRcIikuYmx1cigpO1xuXHR9O1xuXHRcblx0b3BlbkRvd25sb2FkU3RhdGlvbigpOiB2b2lkIHtcblx0XHRpZih0aGlzLmZ1bGxVcmwoKSAhPSBudWxsKSB7XG5cdFx0XHR2YXIgdXJsID0gdGhpcy5mdWxsVXJsKCk7XG5cdFx0XHRpZih0aGlzLmRzbVZlcnNpb24oKSA8IDcwMDApIC8vIERTTSA1LjIgYW5kIG9sZGVyXG5cdFx0XHRcdHVybCArPSBcIi93ZWJtYW4vaW5kZXguY2dpP2xhdW5jaEFwcD1TWU5PLlNEUy5Eb3dubG9hZFN0YXRpb24uQXBwbGljYXRpb25cIjtcblx0XHRcdGVsc2UgLy8gRFNNIDYuMCBhbmQgbGF0ZXJcblx0XHRcdFx0dXJsICs9IFwiL2luZGV4LmNnaT9sYXVuY2hBcHA9U1lOTy5TRFMuRG93bmxvYWRTdGF0aW9uLkFwcGxpY2F0aW9uXCI7XG5cdFx0XHRcblx0XHRcdGV4dGVuc2lvbi5jcmVhdGVUYWIodXJsKTtcblx0XHRcdGV4dGVuc2lvbi5oaWRlUG9wb3ZlcnMoKTtcblx0XHRcdF9nYXEucHVzaChbJ190cmFja0V2ZW50JyAsICdCdXR0b24nICwgJ1BvcG92ZXIgT3BlbkRvd25sb2FkU3RhdGlvblRhYicgXSApO1xuXHRcdH1cblx0fTtcblx0XG5cdGxvY2FsaXplZFN0cmluZyhuYW1lOiBzdHJpbmcsIHN1YnN0aXR1dGlvbnM6IHN0cmluZ1tdKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gZXh0ZW5zaW9uLmdldExvY2FsaXplZFN0cmluZyhuYW1lLCBzdWJzdGl0dXRpb25zKTtcblx0fTtcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
